{"version":3,"file":"main.js","sources":["src/main.ts"],"sourcesContent":["import { App, Plugin, PluginSettingTab, Setting, Notice, requestUrl, TFile } from 'obsidian';\n\ninterface JWPluginSettings {\n  targetPathTemplate: string;\n  appendToFile: boolean;\n  autoFetchDaily: boolean;\n  lastAutoFetchDate?: string;\n}\n\nconst DEFAULT_SETTINGS: JWPluginSettings = {\n  targetPathTemplate: \"Daily/JW Daily Text - {YYYY}-{MM}-{DD}.md\",\n  appendToFile: true,\n  autoFetchDaily: false,\n  lastAutoFetchDate: \"\"\n};\n\nexport default class JWDailyTextPlugin extends Plugin {\n  settings!: JWPluginSettings;\n  public midnightTimeoutId: number | null = null;\n  public dailyIntervalId: number | null = null;\n\n  async onload() {\n    console.log('Loading JW Daily Text plugin');\n    await this.loadSettings();\n\n    this.addCommand({\n      id: 'jw-fetch-daily-text',\n      name: 'Fetch JW Daily Text',\n      callback: async () => {\n        await this.fetchAndWriteDailyText();\n      }\n    });\n\n    this.addCommand({\n      id: 'jw-insert-daily-text-at-cursor',\n      name: 'Insert JW Daily Text at Cursor',\n      callback: async () => {\n        const editor = this.app.workspace.activeEditor?.editor;\n        if (!editor) {\n          new Notice('No active editor found');\n          return;\n        }\n        try {\n          const dailyText = await this.fetchDailyText();\n          const formatted = this.buildMarkdownBlock(new Date(), dailyText);\n          editor.replaceSelection(formatted);\n          new Notice('JW Daily Text inserted at cursor');\n        } catch (error) {\n          console.error('Error inserting daily text:', error);\n          new Notice('Failed to insert JW Daily Text');\n        }\n      }\n    });\n\n    this.addCommand({\n      id: 'jw-open-settings',\n      name: 'JW Daily Text: Open Settings',\n      callback: () => {\n        // settings tab will be opened by user in UI; this is a placeholder\n      }\n    });\n\n    this.addSettingTab(new JWSettingTab(this.app, this));\n\n    if (this.settings.autoFetchDaily) {\n      this.scheduleDailyAutoFetch();\n    }\n\n    console.log('JW Daily Text plugin loaded');\n  }\n\n  onunload() {\n    console.log('Unloading JW Daily Text plugin');\n    if (this.midnightTimeoutId) {\n      window.clearTimeout(this.midnightTimeoutId);\n      this.midnightTimeoutId = null;\n    }\n    if (this.dailyIntervalId) {\n      window.clearInterval(this.dailyIntervalId);\n      this.dailyIntervalId = null;\n    }\n  }\n\n  async loadSettings() {\n    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());\n  }\n\n  async saveSettings() {\n    await this.saveData(this.settings);\n  }\n\n  private pad(n: number) {\n    return n < 10 ? `0${n}` : `${n}`;\n  }\n\n  private buildUrlForDate(date: Date) {\n    const yyyy = date.getFullYear();\n    const mm = this.pad(date.getMonth() + 1);\n    const dd = this.pad(date.getDate());\n    return `https://wol.jw.org/wol/dt/r1/lp-e/${yyyy}/${mm}/${dd}`;\n  }\n\n  private formatPathTemplate(template: string, date: Date) {\n    const YYYY = date.getFullYear().toString();\n    const MM = this.pad(date.getMonth() + 1);\n    const DD = this.pad(date.getDate());\n    return template.replace(/{YYYY}/g, YYYY).replace(/{MM}/g, MM).replace(/{DD}/g, DD);\n  }\n\n  private parseDailyHtml(htmlString: string) {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(htmlString, 'text/html');\n\n    const ems = Array.from(doc.querySelectorAll('em'));\n    const scripture = ems[0]?.textContent?.trim().replace(/.$/, '') ?? '';\n    const citation = ems[1]?.textContent?.trim() ?? '';\n\n    const paragraphs = Array.from(doc.querySelectorAll('p'));\n    let commentary = '';\n    for (const p of paragraphs) {\n      const txt = p.innerHTML\n        .replace(/<a[^>]*href=\"([^\"]+)\"[^>]*>(.*?)<\\/a>/gi, '[$2](https://wol.jw.org/en$1)')\n        .replace(/<[^>]+>/g, '')\n        .replace(/&nbsp;/g, ' ')\n        .trim();\n      if (!txt) continue;\n      if (scripture && txt.includes(scripture)) continue;\n      if (citation && txt.includes(citation)) continue;\n      commentary = txt;\n      break;\n    }\n\n    if (!commentary) {\n      commentary = doc.body?.innerHTML\n        .replace(/<a[^>]*href=\"([^\"]+)\"[^>]*>(.*?)<\\/a>/gi, '[$2](https://wol.jw.org/en$1)')\n        .replace(/<[^>]+>/g, '')\n        .replace(/&nbsp;/g, ' ')\n        .trim() ?? '';\n    }\n\n    return { scripture, citation, commentary };\n  }\n\n  private buildMarkdownBlock(date: Date, parsed: { scripture: string; citation: string; commentary: string }) {\n    const dateStr = date.toISOString().slice(0, 10);\n    let md = `# Daily Text - ${dateStr}\\n\\n`;\n    \n    if (parsed.citation) {\n      md += `>[!bible] ${parsed.citation}\\n`;\n    }\n    if (parsed.scripture) {\n      md += `${parsed.scripture}\\n\\n`;\n    }\n    if (parsed.commentary) {\n      md += `${parsed.commentary}\\n\\n`;\n    }\n    md += `---\\n\\n`;\n    return md;\n  }\n\n  private async writeToVault(path: string, content: string, append: boolean) {\n    const vault = this.app.vault;\n    try {\n      const existing = vault.getAbstractFileByPath(path);\n      if (!existing) {\n        await vault.create(path, content);\n      } else {\n        if (append) {\n          try {\n            // @ts-ignore - Vault.append exists in Obsidian API\n            await vault.append(path, content);\n          } catch (e) {\n            const current = await vault.read(existing as TFile);\n            await vault.modify(existing as TFile, current + content);\n          }\n        } else {\n          await vault.modify(existing as TFile, content);\n        }\n      }\n      new Notice(`JW Daily Text written to ${path}`);\n    } catch (error) {\n      console.error('Error writing to vault:', error);\n      new Notice(`Error writing JW Daily Text to ${path}`);\n    }\n  }\n\n  private async fetchDailyText(forDate?: Date): Promise<{ scripture: string; citation: string; commentary: string }> {\n    const targetDate = forDate ?? new Date();\n    const url = this.buildUrlForDate(targetDate);\n\n    const res = await requestUrl({ url, headers: { Accept: 'application/json' } });\n    const text = res?.text ?? '';\n    if (!text) throw new Error('Empty response from requestUrl');\n\n    let json: any;\n    try {\n      json = JSON.parse(text);\n    } catch (err) {\n      throw new Error('Failed to parse response JSON: ' + (err as Error).message);\n    }\n\n    if (!json.items || !json.items[0] || !json.items[0].content) {\n      throw new Error('Unexpected response format (no items/content)');\n    }\n\n    const htmlContent: string = json.items[0].content;\n    return this.parseDailyHtml(htmlContent);\n  }\n\n  async fetchAndWriteDailyText(forDate?: Date) {\n    const targetDate = forDate ?? new Date();\n    const url = this.buildUrlForDate(targetDate);\n\n    new Notice('Fetching JW Daily Text...');\n    console.log('Fetching JW Daily Text from:', url);\n\n    try {\n      const res = await requestUrl({ url, headers: { Accept: 'application/json' } });\n      const text = res?.text ?? '';\n      if (!text) throw new Error('Empty response from requestUrl');\n\n      let json: any;\n      try {\n        json = JSON.parse(text);\n      } catch (err) {\n        throw new Error('Failed to parse response JSON: ' + (err as Error).message);\n      }\n\n      if (!json.items || !json.items[0] || !json.items[0].content) {\n        throw new Error('Unexpected response format (no items/content)');\n      }\n\n      const htmlContent: string = json.items[0].content;\n      const parsed = this.parseDailyHtml(htmlContent);\n      const md = this.buildMarkdownBlock(targetDate, parsed);\n\n      const path = this.formatPathTemplate(this.settings.targetPathTemplate, targetDate);\n      await this.writeToVault(path, md, this.settings.appendToFile);\n\n      console.log('Fetch complete:', { parsed, path });\n    } catch (error) {\n      console.error('Error fetching daily text:', error);\n      new Notice('Error fetching JW Daily Text (see console)');\n    }\n  }\n\n  public scheduleDailyAutoFetch() {\n    if (this.midnightTimeoutId) {\n      window.clearTimeout(this.midnightTimeoutId);\n      this.midnightTimeoutId = null;\n    }\n    if (this.dailyIntervalId) {\n      window.clearInterval(this.dailyIntervalId);\n      this.dailyIntervalId = null;\n    }\n\n    const now = new Date();\n    const tomorrow = new Date(now);\n    tomorrow.setDate(now.getDate() + 1);\n    tomorrow.setHours(0, 0, 5, 0); // 00:00:05 local\n    const msUntilMidnight = tomorrow.getTime() - now.getTime();\n\n    this.midnightTimeoutId = window.setTimeout(async () => {\n      await this.maybePerformAutoFetch();\n      this.dailyIntervalId = window.setInterval(async () => {\n        await this.maybePerformAutoFetch();\n      }, 24 * 60 * 60 * 1000) as unknown as number;\n    }, msUntilMidnight) as unknown as number;\n\n    console.log('Scheduled JW auto-fetch to run in ms:', msUntilMidnight);\n  }\n\n  private async maybePerformAutoFetch() {\n    const todayIso = new Date().toISOString().slice(0, 10);\n    if (this.settings.lastAutoFetchDate === todayIso) {\n      console.log('JW Daily Text: already auto-fetched today, skipping.');\n      return;\n    }\n    console.log('JW Daily Text: performing auto-fetch for today:', todayIso);\n    await this.fetchAndWriteDailyText(new Date());\n    this.settings.lastAutoFetchDate = todayIso;\n    await this.saveSettings();\n  }\n}\n\n/* Settings tab */\nclass JWSettingTab extends PluginSettingTab {\n  plugin: JWDailyTextPlugin;\n\n  constructor(app: App, plugin: JWDailyTextPlugin) {\n    super(app, plugin);\n    this.plugin = plugin;\n  }\n\n  display(): void {\n    const containerEl = this.containerEl;\n    containerEl.empty();\n\n    containerEl.createEl('h2', { text: 'JW Daily Text settings' });\n\n    new Setting(containerEl)\n      .setName('Target file path template')\n      .setDesc('Use {YYYY}, {MM}, {DD} in the template. Example: Daily/JW Daily Text - {YYYY}-{MM}-{DD}.md')\n      .addText((text) =>\n        text\n          .setPlaceholder(DEFAULT_SETTINGS.targetPathTemplate)\n          .setValue(this.plugin.settings.targetPathTemplate)\n          .onChange(async (value: string) => {\n            this.plugin.settings.targetPathTemplate = value.trim() || DEFAULT_SETTINGS.targetPathTemplate;\n            await this.plugin.saveSettings();\n          })\n      );\n\n    new Setting(containerEl)\n      .setName('Append to file')\n      .setDesc('If true, new daily text will be appended. If false, the target file will be overwritten.')\n      .addToggle((toggle) =>\n        toggle.setValue(this.plugin.settings.appendToFile).onChange(async (value: boolean) => {\n          this.plugin.settings.appendToFile = value;\n          await this.plugin.saveSettings();\n        })\n      );\n\n    new Setting(containerEl)\n      .setName('Auto-fetch daily')\n      .setDesc('If enabled, the plugin will automatically fetch the daily text once per day at midnight.')\n      .addToggle((toggle) =>\n        toggle.setValue(this.plugin.settings.autoFetchDaily).onChange(async (value: boolean) => {\n          this.plugin.settings.autoFetchDaily = value;\n          await this.plugin.saveSettings();\n\n          if (value) {\n            this.plugin.scheduleDailyAutoFetch();\n            new Notice('JW Daily Text: auto-fetch enabled (runs at local midnight)');\n          } else {\n            if (this.plugin.midnightTimeoutId) {\n              window.clearTimeout(this.plugin.midnightTimeoutId);\n              this.plugin.midnightTimeoutId = null;\n            }\n            if (this.plugin.dailyIntervalId) {\n              window.clearInterval(this.plugin.dailyIntervalId);\n              this.plugin.dailyIntervalId = null;\n            }\n            new Notice('JW Daily Text: auto-fetch disabled');\n          }\n        })\n      );\n\n    new Setting(containerEl)\n      .setName('Manual fetch now')\n      .setDesc('Click to fetch the daily text immediately and write it to the target file.')\n      .addButton((btn) =>\n        btn.setButtonText('Fetch Now').setCta().onClick(async () => {\n          await this.plugin.fetchAndWriteDailyText();\n        })\n      );\n\n    containerEl.createEl('hr');\n    containerEl.createEl('p', {\n      text:\n        'Note: This plugin fetches JSON from wol.jw.org using requestUrl (no CORS in desktop Obsidian). If fetching fails due to remote changes, check the console for details.'\n    });\n  }\n}"],"names":["Plugin","Notice","requestUrl","PluginSettingTab","Setting"],"mappings":"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"}